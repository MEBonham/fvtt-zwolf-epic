<section class="sheet-header-wrapper {{#if isMook}}mook-header{{/if}}{{#if isSpawn}}spawn-header{{/if}}" data-part-id="header">
  <header class="sheet-header">
    <img class="profile-img" src="{{document.img}}" data-action="editImage" title="{{document.name}}" />
    <div class="header-fields">
      <h1 class="charname">
        <input name="name" type="text" value="{{document.name}}" placeholder="{{#if isCharacter}}Character{{else if isMook}}Mook{{else}}Spawn{{/if}} Name" />
      </h1>
      
      {{#if (or isMook isSpawn)}}
      <div class="header-line-base">
        {{> base-creature-selector}}
      </div>
      {{/if}}
      
      <div class="header-line-2">
        <div class="header-field level-field">
          <label>Level</label>
          <input type="number" name="system.level" value="{{document.system.level}}" min="0" max="20" />
        </div>
        
        <div class="header-field size-field">
          <label>Size</label>
          {{#if isCharacter}}
            <select name="system.size" value="{{document.system.size}}">
              {{#if ancestry.system.sizeOptions.length}}
                {{#each ancestry.system.sizeOptions as |size|}}
                  <option value="{{size}}" {{#if (eq ../document.system.size size)}}selected{{/if}}>{{capitalize size}}</option>
                {{/each}}
              {{else}}
                <option value="medium" {{#if (eq document.system.size "medium")}}selected{{/if}}>Medium</option>
              {{/if}}
            </select>
            {{#if ancestry}}
              <div class="size-source" title="Size options from {{ancestry.name}}">
                <i class="fas fa-info-circle"></i>
              </div>
            {{/if}}
          {{else if (or isMook isSpawn)}}
            <select name="system.size" value="{{document.system.size}}">
              {{#if baseCreature.system.size}}
                <option value="{{baseCreature.system.size}}" selected>{{capitalize baseCreature.system.size}} (from base)</option>
              {{else}}
                <option value="medium" {{#if (eq document.system.size "medium")}}selected{{/if}}>Medium</option>
                <option value="small" {{#if (eq document.system.size "small")}}selected{{/if}}>Small</option>
                <option value="large" {{#if (eq document.system.size "large")}}selected{{/if}}>Large</option>
              {{/if}}
            </select>
          {{/if}}
        </div>
        
        <div class="header-field tags-field">
          <label>Tags</label>
          <div class="tags-display">{{characterTags}}</div>
        </div>
      </div>
    </div>
  </header>

  <!-- Header Resources -->
  <div class="header-resources {{#if isMook}}mook-resources{{/if}}{{#if isSpawn}}spawn-resources{{/if}}">
    <div class="resource vp-resource">
      <label>VP</label>
      <div class="resource-values">
        <input type="number" name="system.vitalityPoints.value" value="{{document.system.vitalityPoints.value}}" />
        <span class="sep">/</span>
        <span class="max-value">{{calculatedValues.maxVitality}}</span>
      </div>
    </div>
    
    <div class="resource sp-resource">
      <label>SP</label>
      <div class="resource-values">
        <input type="number" name="system.staminaPoints.value" value="{{document.system.staminaPoints.value}}" />
        <span class="sep">/</span>
        <span class="max-value">{{calculatedValues.maxStamina}}</span>
      </div>
    </div>
    
    {{#if (eq document.type "pc")}}
    <div class="resource kp-resource">
      <label>KP</label>
      <div class="resource-values">
        <input type="number" name="system.karmaPoints.value" value="{{document.system.karmaPoints.value}}" />
        <span class="sep">/</span>
        <span class="max-value">{{document.system.karmaPoints.max}}</span>
      </div>
    </div>
    {{/if}}
    
    <div class="resource cn-resource">
      <label>CN</label>
      <div class="resource-value-single">
        <span class="calculated-value">{{calculatedValues.coastNumber}}</span>
      </div>
    </div>
    
    {{#unless sideEffects.speedProgression}}
    <div class="resource speed-resource">
      <label>Speed</label>
      <div class="resource-value-single">
        <div class="speed-with-roll">
          <span class="static-value">+0</span>
          <i class="fas fa-dice-d12 speed-roll-die" 
            data-action="rollSpeed"
            data-modifier="0" 
            data-flavor="Speed Check"
            title="Roll Speed Check (+0)"></i>
        </div>
      </div>
    </div>
    {{/unless}}

    {{#if isCharacter}}
    <div class="resource rest-buttons-resource">
      <div class="rest-button-stack">
        <button type="button" class="rest-button short-rest-btn" data-action="shortRest" title="Short Rest: -1 SP, restore VP to max, gain Suffused">
          <i class="fas fa-moon"></i>
          <span class="rest-label">Short Rest</span>
        </button>
        <button type="button" class="rest-button extended-rest-btn" data-action="extendedRest" title="Extended Rest: restore SP & VP to max, gain Suffused, remove Bruised, reminder to roll Fortitude">
          <i class="fas fa-bed"></i>
          <span class="rest-label">Extended Rest</span>
        </button>
      </div>
    </div>
    {{/if}}
  </div>

<!-- Target Numbers -->
  <div class="header-tns {{#if isMook}}mook-tns{{/if}}{{#if isSpawn}}spawn-tns{{/if}}">
    {{#if isCharacter}}
      <div class="tn-group tn-group-primary">
        <div class="tn-item">
          <label>Toughness TN</label>
          <div class="tn-value">{{tns.toughness}}</div>
        </div>
        
        <div class="tn-item">
          <label>Destiny TN</label>
          <div class="tn-value">{{tns.destiny}}</div>
        </div>
      </div>
      
      <div class="tn-divider"></div>
      
      <div class="tn-group tn-group-secondary">
        <div class="tn-item">
          <label>Improvised TN</label>
          <div class="tn-value">{{tns.improvised}}</div>
        </div>
        
        <div class="tn-item">
          <label>Healing TN</label>
          <div class="tn-value">{{tns.healing}}</div>
        </div>
        
        <div class="tn-item">
          <label>Challenge TN</label>
          <div class="tn-value">{{tns.challenge}}</div>
        </div>
      </div>
    {{else if isMook}}
      <div class="tn-group tn-group-mook">
        <div class="tn-item tn-combined">
          <label>Toughness/Destiny TN</label>
          <div class="tn-value">{{tns.combined}}</div>
        </div>
      </div>
    {{else if isSpawn}}
      <div class="tn-group tn-group-spawn">
        <div class="tn-item">
          <label>Toughness TN</label>
          <div class="tn-value">{{tns.toughness}}</div>
        </div>
        
        <div class="tn-item">
          <label>Destiny TN</label>
          <div class="tn-value">{{tns.destiny}}</div>
        </div>
      </div>
    {{/if}}
    
    {{#if abilityCategories.exoticSenses.length}}
    <div class="exotic-senses-icon" title="{{#each abilityCategories.exoticSenses}}{{name}}{{#if tags}} Â· <{{tags}}>{{/if}}{{#unless @last}}, {{/unless}}{{/each}}">
      <i class="fas fa-eye"></i>
    </div>
    {{/if}}
  </div>
</section>