{{!-- templates/item/partials/side-effects-form.hbs --}}
<div class="side-effects-form">

  <!-- Side Effects List -->
  <div class="side-effects-list">
    {{#if sideEffectsArray}}
      {{#each sideEffectsArray}}
        <div class="side-effect-item" data-effect-index="{{this.index}}">
          <!-- Hidden ID field to preserve effect identity -->
          <input type="hidden" name="{{this.pathPrefix}}.id" value="{{this.id}}"/>

          <div class="side-effect-controls">
            <!-- Type Selection -->
            <div class="side-effect-type">
              <label>{{localize 'ZWOLF.SideEffectType'}}</label>
              <select name="{{this.pathPrefix}}.type" data-dtype="String">
                <option value="characterTag" {{selected 'characterTag' this.type}}>
                  {{localize 'ZWOLF.SideEffectTypeCharacterTag'}}
                </option>
                <option value="proficiency" {{selected 'proficiency' this.type}}>
                  {{localize 'ZWOLF.SideEffectTypeProficiency'}}
                </option>
                <option value="speedProgression" {{selected 'speedProgression' this.type}}>
                  {{localize 'ZWOLF.SideEffectTypeSpeedProgression'}}
                </option>
                <option value="toughnessTNProgression" {{selected 'toughnessTNProgression' this.type}}>
                  {{localize 'ZWOLF.SideEffectTypeToughnessTNProgression'}}
                </option>
                <option value="destinyTNProgression" {{selected 'destinyTNProgression' this.type}}>
                  {{localize 'ZWOLF.SideEffectTypeDestinyTNProgression'}}
                </option>
                <option value="nightsightRadius" {{selected 'nightsightRadius' this.type}}>
                  {{localize 'ZWOLF.SideEffectTypeNightsightRadius'}}
                </option>
                <option value="darkvisionRadius" {{selected 'darkvisionRadius' this.type}}>
                  {{localize 'ZWOLF.SideEffectTypeDarkvisionRadius'}}
                </option>
                <option value="bulkCapacityBoost" {{selected 'bulkCapacityBoost' this.type}}>
                  {{localize 'ZWOLF.SideEffectTypeBulkCapacityBoost'}}
                </option>
                <option value="sizeModifier" {{selected 'sizeModifier' this.type}}>
                  {{localize 'ZWOLF.SideEffectTypeSizeModifier'}}
                </option>
                <option value="resistance" {{selected 'resistance' this.type}}>
                  {{localize 'ZWOLF.SideEffectTypeResistance'}}
                </option>
                <option value="vulnerability" {{selected 'vulnerability' this.type}}>
                  {{localize 'ZWOLF.SideEffectTypeVulnerability'}}
                </option>
              </select>
            </div>

            {{#if (eq ../itemType "track")}}
              <!-- Tier Selection (Track items only) -->
              <div class="side-effect-tier">
                <label>{{localize 'ZWOLF.Tier'}}</label>
                <select name="{{this.pathPrefix}}.tier" data-dtype="Number">
                  <option value="1" {{selected 1 this.tier}}>{{localize 'ZWOLF.Tier'}} 1</option>
                  <option value="2" {{selected 2 this.tier}}>{{localize 'ZWOLF.Tier'}} 2</option>
                  <option value="3" {{selected 3 this.tier}}>{{localize 'ZWOLF.Tier'}} 3</option>
                  <option value="4" {{selected 4 this.tier}}>{{localize 'ZWOLF.Tier'}} 4</option>
                  <option value="5" {{selected 5 this.tier}}>{{localize 'ZWOLF.Tier'}} 5</option>
                </select>
              </div>
            {{/if}}

            <!-- Value Input (dynamic based on type) -->
            <div class="side-effect-value">
              <label>{{localize 'ZWOLF.SideEffectValue'}}</label>

              {{#if (eq this.type 'characterTag')}}
                <!-- Text input for character tags -->
                <input type="text"
                       name="{{this.pathPrefix}}.value"
                       value="{{this.value}}"
                       placeholder="{{localize 'ZWOLF.CharacterTagsPlaceholder'}}"/>

              {{else if (eq this.type 'proficiency')}}
                <!-- Dropdown for proficiencies -->
                <select name="{{this.pathPrefix}}.value" data-dtype="String">
                  <option value="" {{selected '' this.value}}>
                    {{localize 'ZWOLF.None'}}
                  </option>
                  <optgroup label="{{localize 'ZWOLF.SeedProficiencies'}}">
                    {{#each ../config.proficiencies}}
                      {{#if (eq this.type 'seed')}}
                        <option value="{{@key}}" {{selected @key ../this.value}}>
                          {{this.label}}
                        </option>
                      {{/if}}
                    {{/each}}
                  </optgroup>
                  <optgroup label="{{localize 'ZWOLF.WeaponProficiencies'}}">
                    {{#each ../config.proficiencies}}
                      {{#if (eq this.type 'weapon')}}
                        <option value="{{@key}}" {{selected @key ../this.value}}>
                          {{this.label}}
                        </option>
                      {{/if}}
                    {{/each}}
                  </optgroup>
                  <optgroup label="{{localize 'ZWOLF.MiscellaneousProficiencies'}}">
                    {{#each ../config.proficiencies}}
                      {{#if (eq this.type 'miscellaneous')}}
                        <option value="{{@key}}" {{selected @key ../this.value}}>
                          {{this.label}}
                        </option>
                      {{/if}}
                    {{/each}}
                  </optgroup>
                </select>

              {{else if (eq this.type 'speedProgression')}}
                <!-- Dropdown for speed progression (no "None" - if no progression, don't add effect) -->
                <select name="{{this.pathPrefix}}.value" data-dtype="String">
                  <option value="mediocre" {{selected 'mediocre' this.value}}>
                    {{localize 'ZWOLF.Mediocre'}}
                  </option>
                  <option value="moderate" {{selected 'moderate' this.value}}>
                    {{localize 'ZWOLF.Moderate'}}
                  </option>
                  <option value="specialty" {{selected 'specialty' this.value}}>
                    {{localize 'ZWOLF.Specialty'}}
                  </option>
                  <option value="awesome" {{selected 'awesome' this.value}}>
                    {{localize 'ZWOLF.Awesome'}}
                  </option>
                </select>

              {{else if (eq this.type 'toughnessTNProgression')}}
                <!-- Dropdown for Toughness TN (defaults to Mediocre Bonus, so only Moderate/Specialty/Awesome) -->
                <select name="{{this.pathPrefix}}.value" data-dtype="String">
                  <option value="moderate" {{selected 'moderate' this.value}}>
                    {{localize 'ZWOLF.Moderate'}}
                  </option>
                  <option value="specialty" {{selected 'specialty' this.value}}>
                    {{localize 'ZWOLF.Specialty'}}
                  </option>
                  <option value="awesome" {{selected 'awesome' this.value}}>
                    {{localize 'ZWOLF.Awesome'}}
                  </option>
                </select>

              {{else if (eq this.type 'destinyTNProgression')}}
                <!-- Dropdown for Destiny TN (defaults to Moderate, so only Specialty/Awesome) -->
                <select name="{{this.pathPrefix}}.value" data-dtype="String">
                  <option value="specialty" {{selected 'specialty' this.value}}>
                    {{localize 'ZWOLF.Specialty'}}
                  </option>
                  <option value="awesome" {{selected 'awesome' this.value}}>
                    {{localize 'ZWOLF.Awesome'}}
                  </option>
                </select>

              {{else if (or (eq this.type 'nightsightRadius') (eq this.type 'darkvisionRadius'))}}
                <!-- Number input for vision radii -->
                <div class="vision-input-group">
                  <input type="number"
                         name="{{this.pathPrefix}}.value"
                         value="{{this.value}}"
                         data-dtype="Number"
                         min="0"
                         step="0.5"
                         placeholder="0"/>
                  <span class="input-suffix">{{localize 'ZWOLF.Meters'}}</span>
                </div>

              {{else if (or (eq this.type 'bulkCapacityBoost') (eq this.type 'sizeModifier'))}}
                <!-- Number input for bulk/size modifiers -->
                <input type="number"
                       name="{{this.pathPrefix}}.value"
                       value="{{this.value}}"
                       data-dtype="Number"
                       step="1"
                       placeholder="0"/>

              {{else if (eq this.type 'resistance')}}
                <!-- Dropdown for damage type resistance -->
                <select name="{{this.pathPrefix}}.value" data-dtype="String">
                  <option value="" {{selected '' this.value}}>
                    {{localize 'ZWOLF.None'}}
                  </option>
                  {{#each ../config.damageTypes}}
                    <option value="{{@key}}" {{selected @key ../this.value}}>
                      {{localize this.label}}
                    </option>
                  {{/each}}
                </select>

              {{else if (eq this.type 'vulnerability')}}
                <!-- Dropdown for damage type vulnerability -->
                <select name="{{this.pathPrefix}}.value" data-dtype="String">
                  <option value="" {{selected '' this.value}}>
                    {{localize 'ZWOLF.None'}}
                  </option>
                  {{#each ../config.damageTypes}}
                    <option value="{{@key}}" {{selected @key ../this.value}}>
                      {{localize this.label}}
                    </option>
                  {{/each}}
                </select>

              {{else}}
                <!-- Fallback text input -->
                <input type="text"
                       name="{{this.pathPrefix}}.value"
                       value="{{this.value}}"
                       placeholder=""/>
              {{/if}}
            </div>

            <!-- Delete Button -->
            <div class="side-effect-delete">
              <button type="button"
                      class="delete-side-effect"
                      data-action="delete-side-effect"
                      data-tooltip="{{localize 'ZWOLF.DeleteSideEffect'}}">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      {{/each}}
    {{/if}}

    <!-- No side effects message -->
    {{#unless sideEffectsArray.length}}
      <p class="no-side-effects">
        <i class="fas fa-info-circle"></i>
        {{localize 'ZWOLF.NoSideEffects'}}
      </p>
    {{/unless}}
  </div>

  <!-- Add Side Effect Button -->
  <div class="add-side-effect-container">
    <button type="button"
            class="add-side-effect"
            data-action="add-side-effect">
      <i class="fas fa-plus"></i>
      {{localize 'ZWOLF.AddSideEffect'}}
    </button>
  </div>

</div>