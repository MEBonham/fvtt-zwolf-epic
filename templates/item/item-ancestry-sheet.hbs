<form class="{{cssClass}} flexcol" autocomplete="off">
  <div class="item-sheet-content">
    <header class="sheet-header">
      <img class="profile-img" src="{{item.img}}" data-edit="img" title="{{item.name}}" height="64" width="64"/>
      <div class="header-fields">
        <h1 class="charname">
          <input name="name" type="text" value="{{item.name}}" placeholder="{{localize 'ZWOLF.ItemName'}}"/>
        </h1>
        <div class="item-subtitle">{{localize 'ZWOLF.ItemTypeAncestry'}}</div>
      </div>
    </header>

    <nav class="sheet-tabs tabs" data-group="primary">
      <a class="item" data-tab="details">{{localize 'ZWOLF.Details'}}</a>
      <a class="item" data-tab="sideeffects">{{localize 'ZWOLF.SideEffects'}}</a>
      <a class="item" data-tab="abilities">{{localize 'ZWOLF.GrantedAbilities'}}</a>
      <a class="item" data-tab="knacks">{{localize 'ZWOLF.KnackMenus'}}</a>
    </nav>

    <section class="sheet-body">
      <div class="tab" data-group="primary" data-tab="details">
        <div class="form-group">
          <label>{{localize 'ZWOLF.BuildPoints'}}</label>
          <input type="number" name="system.buildPoints" value="{{system.buildPoints}}" data-dtype="Number" min="0"/>
        </div>

        <div class="form-group">
          <label>{{localize 'ZWOLF.AncestryTags'}}</label>
          <input type="text" name="system.ancestryTags" value="{{join system.ancestryTags}}" placeholder="{{localize 'ZWOLF.AncestryTagsPlaceholder'}}"/>
          <p class="notes">{{localize 'ZWOLF.AncestryTagsHint'}}</p>
        </div>

        <div class="form-group">
          <label>{{localize 'ZWOLF.CharacterTags'}}</label>
          <input type="text" name="system.characterTags" value="{{join system.characterTags}}" placeholder="{{localize 'ZWOLF.CharacterTagsPlaceholder'}}"/>
          <p class="notes">{{localize 'ZWOLF.CharacterTagsHint'}}</p>
        </div>

        <div class="form-group">
          <label>{{localize 'ZWOLF.Required'}}</label>
          <div class="form-fields">
            {{editor system.required target="system.required" button=true owner=owner editable=editable}}
          </div>
        </div>

        <div class="form-group">
          <label>{{localize 'ZWOLF.SizeOptions'}}</label>
          <div class="form-fields">
            <select name="system.sizeOptions" multiple size="8" style="width: 100%;">
              <option value="diminutive" {{#if (includes system.sizeOptions "diminutive")}}selected{{/if}}>{{localize 'ZWOLF.Diminutive'}}</option>
              <option value="tiny" {{#if (includes system.sizeOptions "tiny")}}selected{{/if}}>{{localize 'ZWOLF.Tiny'}}</option>
              <option value="small" {{#if (includes system.sizeOptions "small")}}selected{{/if}}>{{localize 'ZWOLF.Small'}}</option>
              <option value="medium" {{#if (includes system.sizeOptions "medium")}}selected{{/if}}>{{localize 'ZWOLF.Medium'}}</option>
              <option value="large" {{#if (includes system.sizeOptions "large")}}selected{{/if}}>{{localize 'ZWOLF.Large'}}</option>
              <option value="huge" {{#if (includes system.sizeOptions "huge")}}selected{{/if}}>{{localize 'ZWOLF.Huge'}}</option>
              <option value="gargantuan" {{#if (includes system.sizeOptions "gargantuan")}}selected{{/if}}>{{localize 'ZWOLF.Gargantuan'}}</option>
              <option value="colossal" {{#if (includes system.sizeOptions "colossal")}}selected{{/if}}>{{localize 'ZWOLF.Colossal'}}</option>
            </select>
            <p class="notes">{{localize 'ZWOLF.SizeOptionsHint'}}</p>
          </div>
        </div>
      </div>

      <div class="tab" data-group="primary" data-tab="sideeffects">
        <div class="side-effects">
          <div class="side-effects-header">
            <h3>{{localize 'ZWOLF.SideEffects'}}</h3>
            <p class="notes">{{localize 'ZWOLF.SideEffectsHint'}}</p>
          </div>
          
          {{> side-effects-form 
              sideEffects=system.sideEffects 
              pathPrefix="system.sideEffects"
              showKnacksProvided=false
              showMaxBulkBoost=false}}
        </div>
      </div>

      <div class="tab" data-group="primary" data-tab="abilities">
        <div class="granted-abilities">
          <div class="abilities-header">
            <h3>{{localize 'ZWOLF.GrantedAbilities'}}</h3>
            <a class="ability-control" data-action="add-ability" title="{{localize 'ZWOLF.AddAbility'}}">
              <i class="fas fa-plus"></i>
            </a>
          </div>
          
          <div class="abilities-list">
            {{#each system.grantedAbilities as |ability index|}}
            {{> ability-item 
                ability=ability 
                index=index 
                nameTarget=(concat "system.grantedAbilities." index ".name")
                tagsTarget=(concat "system.grantedAbilities." index ".tags")
                typeTarget=(concat "system.grantedAbilities." index ".type")
                descriptionTarget=(concat "system.grantedAbilities." index ".description")
                deleteAction="delete-ability"
                editable=../editable}}
            {{/each}}
          </div>
        </div>
      </div>

      <!-- Knacks Tab -->
      <div class="tab" data-group="primary" data-tab="knacks">
        <div class="knack-menus">
          <div class="knack-menus-header">
            <h3>{{localize 'ZWOLF.KnackMenus'}}</h3>
            <a class="knack-control" data-action="add-knack-menu" title="{{localize 'ZWOLF.AddKnackMenu'}}">
              <i class="fas fa-plus"></i>
            </a>
          </div>
          
          <div class="knack-menus-list">
            {{#each system.knackMenus as |menu index|}}
            <div class="knack-menu-item" data-menu-index="{{index}}">
              <div class="knack-menu-controls">
                <a class="knack-control" data-action="delete-knack-menu" data-menu-index="{{index}}" title="{{localize 'ZWOLF.DeleteKnackMenu'}}">
                  <i class="fas fa-trash"></i>
                </a>
              </div>
              
              <div class="form-group">
                <label>{{localize 'ZWOLF.MenuName'}}</label>
                <input type="text" name="system.knackMenus.{{index}}.name" value="{{menu.name}}" placeholder="{{localize 'ZWOLF.KnackMenuNamePlaceholder'}}"/>
              </div>
              
              <div class="form-group">
                <label>{{localize 'ZWOLF.SelectionCount'}}</label>
                <input type="number" name="system.knackMenus.{{index}}.selectionCount" value="{{menu.selectionCount}}" data-dtype="Number" min="1"/>
                <p class="notes">{{localize 'ZWOLF.SelectionCountHint'}}</p>
              </div>
              
              <div class="form-group">
                <label>{{localize 'ZWOLF.AvailableKnacks'}}</label>
                <div class="form-fields">
                  {{#if @root.editable}}
                    {{editor menu.description target=(concat "system.knackMenus." @index ".description") button=true editable=editable engine="prosemirror" collaborate=false}}
                  {{else}}
                    <div class="editor-content">{{{menu.enrichedDescription}}}</div>
                  {{/if}}
                </div>
                <p class="notes">{{localize 'ZWOLF.KnackMenuDescriptionHint'}}</p>
              </div>
              
              <!-- Deprecated knackIds field - keep for backwards compatibility but hide -->
              <div class="form-group" style="display: none;">
                <input type="text" name="system.knackMenus.{{index}}.knackIds" value="{{join menu.knackIds}}" placeholder="{{localize 'ZWOLF.KnackIdsPlaceholder'}}"/>
              </div>
            </div>
            {{/each}}
          </div>
        </div>
      </div>
    </section>
  </div>
</form>
