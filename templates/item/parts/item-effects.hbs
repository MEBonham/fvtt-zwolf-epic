{{!-- templates/item/parts/item-effects.hbs --}}
<section class="tab effects" data-tab="effects">
  <div class="effects-container">
    
    <!-- Active Effects (Foundry's built-in system) -->
    <div class="active-effects-section">
      <h3><i class="fas fa-magic"></i> {{localize 'EFFECT.ActiveEffects'}}</h3>
      <div class="effects-list">
        {{#each item.effects}}
        <div class="effect-item" data-effect-id="{{this.id}}">
          <div class="effect-image">
            <img src="{{this.icon}}" alt="{{this.name}}" width="24" height="24">
          </div>
          <div class="effect-name">
            <span class="effect-title">{{this.name}}</span>
            {{#if this.disabled}}
            <span class="effect-status disabled">{{localize 'EFFECT.Disabled'}}</span>
            {{else}}
            <span class="effect-status enabled">{{localize 'EFFECT.Enabled'}}</span>
            {{/if}}
          </div>
          <div class="effect-controls">
            <a class="effect-control" data-action="edit" title="{{localize 'EFFECT.Edit'}}">
              <i class="fas fa-edit"></i>
            </a>
            <a class="effect-control" data-action="toggle" title="{{localize 'EFFECT.Toggle'}}">
              {{#if this.disabled}}
              <i class="fas fa-eye"></i>
              {{else}}
              <i class="fas fa-eye-slash"></i>
              {{/if}}
            </a>
            <a class="effect-control" data-action="delete" title="{{localize 'EFFECT.Delete'}}">
              <i class="fas fa-trash"></i>
            </a>
          </div>
        </div>
        {{/each}}
        
        {{#unless item.effects}}
        <div class="no-effects">
          <p class="notes">{{localize 'ZWOLF.NoActiveEffects'}}</p>
        </div>
        {{/unless}}
      </div>
      
      {{#if editable}}
      <div class="effect-actions">
        <button type="button" class="add-effect" data-action="create-effect">
          <i class="fas fa-plus"></i> {{localize 'EFFECT.Create'}}
        </button>
      </div>
      {{/if}}
    </div>
    
    <!-- Side Effects Section -->
    <div class="side-effects-section">
      <h3><i class="fas fa-cogs"></i> {{localize 'ZWOLF.SideEffects'}}</h3>
      <p class="section-description">{{localize 'ZWOLF.SideEffectsDescription'}}</p>
      
      <!-- Inline Side Effects Form -->
      <div class="side-effects-form">
        
        {{#if (or (eq itemType "talent") (eq itemType "track"))}}
        <!-- Knacks Provided Section (Talents and Tiers only) -->
        <div class="knacks-provided">
          <h4><i class="fas fa-star"></i> {{localize 'ZWOLF.KnacksProvided'}}</h4>
          <div class="form-group">
            <label>{{localize 'ZWOLF.KnacksProvided'}}</label>
            <input type="number" name="system.sideEffects.knacksProvided" 
                   value="{{system.sideEffects.knacksProvided}}" 
                   data-dtype="Number" min="0" max="10" placeholder="0"/>
            <p class="notes">{{localize 'ZWOLF.KnacksProvidedHint'}}</p>
          </div>
        </div>
        {{/if}}
        
        <!-- Progression Upgrades Section -->
        <div class="progression-upgrades">
          <h4><i class="fas fa-arrow-up"></i> {{localize 'ZWOLF.ProgressionUpgrades'}}</h4>
          
          <!-- Speed Upgrade -->
          <div class="form-group">
            <label>{{localize 'ZWOLF.SpeedProgression'}}</label>
            <select name="system.sideEffects.speedProgression" data-dtype="String">
              <option value="" {{selected '' system.sideEffects.speedProgression}}>{{localize 'ZWOLF.NoUpgrade'}} (+0)</option>
              <option value="mediocre" {{selected 'mediocre' system.sideEffects.speedProgression}}>{{localize 'ZWOLF.Mediocre'}}</option>
              <option value="moderate" {{selected 'moderate' system.sideEffects.speedProgression}}>{{localize 'ZWOLF.Moderate'}}</option>
              <option value="specialty" {{selected 'specialty' system.sideEffects.speedProgression}}>{{localize 'ZWOLF.Specialty'}}</option>
              <option value="awesome" {{selected 'awesome' system.sideEffects.speedProgression}}>{{localize 'ZWOLF.Awesome'}}</option>
            </select>
            <p class="notes">{{localize 'ZWOLF.SpeedProgressionHint'}}</p>
          </div>
          
          <!-- Toughness TN Upgrade -->
          <div class="form-group">
            <label>{{localize 'ZWOLF.ToughnessTNProgression'}}</label>
            <select name="system.sideEffects.toughnessTNProgression" data-dtype="String">
              <option value="" {{selected '' system.sideEffects.toughnessTNProgression}}>{{localize 'ZWOLF.NoUpgrade'}} ({{localize 'ZWOLF.Mediocre'}})</option>
              <option value="moderate" {{selected 'moderate' system.sideEffects.toughnessTNProgression}}>{{localize 'ZWOLF.Moderate'}}</option>
              <option value="specialty" {{selected 'specialty' system.sideEffects.toughnessTNProgression}}>{{localize 'ZWOLF.Specialty'}}</option>
              <option value="awesome" {{selected 'awesome' system.sideEffects.toughnessTNProgression}}>{{localize 'ZWOLF.Awesome'}}</option>
            </select>
            <p class="notes">{{localize 'ZWOLF.ToughnessTNProgressionHint'}}</p>
          </div>
          
          <!-- Destiny TN Upgrade -->
          <div class="form-group">
            <label>{{localize 'ZWOLF.DestinyTNProgression'}}</label>
            <select name="system.sideEffects.destinyTNProgression" data-dtype="String">
              <option value="" {{selected '' system.sideEffects.destinyTNProgression}}>{{localize 'ZWOLF.NoUpgrade'}} ({{localize 'ZWOLF.Moderate'}})</option>
              <option value="specialty" {{selected 'specialty' system.sideEffects.destinyTNProgression}}>{{localize 'ZWOLF.Specialty'}}</option>
              <option value="awesome" {{selected 'awesome' system.sideEffects.destinyTNProgression}}>{{localize 'ZWOLF.Awesome'}}</option>
            </select>
            <p class="notes">{{localize 'ZWOLF.DestinyTNProgressionHint'}}</p>
          </div>
        </div>
        
        <!-- Vision Radius Upgrades Section -->
        <div class="vision-radius-upgrades">
          <h4><i class="fas fa-eye"></i> {{localize 'ZWOLF.VisionRadiusUpgrades'}}</h4>
          <p class="notes">{{localize 'ZWOLF.VisionRadiusUpgradesHint'}}</p>
          
          <!-- Nightsight Radius -->
          <div class="form-group">
            <label>{{localize 'ZWOLF.NightsightRadius'}}</label>
            <div class="vision-input-group">
              <input type="number" name="system.sideEffects.nightsightRadius" 
                     value="{{system.sideEffects.nightsightRadius}}" 
                     data-dtype="Number" min="0" step="0.5" 
                     placeholder="{{localize 'ZWOLF.DefaultRadius'}}: 1.0"/>
              <span class="input-suffix">{{localize 'ZWOLF.Meters'}}</span>
            </div>
            <p class="notes">{{localize 'ZWOLF.NightsightRadiusHint'}}</p>
          </div>
          
          <!-- Darkvision Radius -->
          <div class="form-group">
            <label>{{localize 'ZWOLF.DarkvisionRadius'}}</label>
            <div class="vision-input-group">
              <input type="number" name="system.sideEffects.darkvisionRadius" 
                     value="{{system.sideEffects.darkvisionRadius}}" 
                     data-dtype="Number" min="0" step="0.5" 
                     placeholder="{{localize 'ZWOLF.DefaultRadius'}}: 0.5"/>
              <span class="input-suffix">{{localize 'ZWOLF.Meters'}}</span>
            </div>
            <p class="notes">{{localize 'ZWOLF.DarkvisionRadiusHint'}}</p>
          </div>
        </div>

        {{#if (eq itemType "equipment")}}
        <!-- Bulk Capacity Upgrades Section (Equipment only) -->
        <div class="bulk-upgrades">
          <h4><i class="fas fa-weight-hanging"></i> {{localize 'ZWOLF.BulkCapacityUpgrades'}}</h4>
          <p class="notes">{{localize 'ZWOLF.BulkCapacityUpgradesHint'}}</p>
          
          <!-- Max Bulk Boost -->
          <div class="form-group">
            <label>{{localize 'ZWOLF.MaxBulkBoost'}}</label>
            <div class="bulk-input-group">
              <input type="number" name="system.sideEffects.maxBulkBoost" 
                     value="{{system.sideEffects.maxBulkBoost}}" 
                     data-dtype="Number" min="0" step="1" 
                     placeholder="0"/>
              <span class="input-suffix">{{localize 'ZWOLF.Bulk'}}</span>
            </div>
            <p class="notes">{{localize 'ZWOLF.MaxBulkBoostHint'}}</p>
          </div>
        </div>
        {{/if}}
        
        <!-- Placeholder for Future Side Effects -->
        <div class="future-side-effects">
          <h4><i class="fas fa-plus-circle"></i> {{localize 'ZWOLF.FutureSideEffects'}}</h4>
          <p class="notes">{{localize 'ZWOLF.FutureSideEffectsHint'}}</p>
        </div>
      </div>
    </div>
    
    <!-- Item-specific effect notes -->
    {{#if (or (eq itemType "talent") (eq itemType "track"))}}
    <div class="effect-notes-section">
      <h4><i class="fas fa-info-circle"></i> {{localize 'ZWOLF.EffectNotes'}}</h4>
      {{#if (eq itemType "talent")}}
      <p class="notes">{{localize 'ZWOLF.TalentEffectNotes'}}</p>
      {{/if}}
      {{#if (eq itemType "track")}}
      <p class="notes">{{localize 'ZWOLF.TrackEffectNotes'}}</p>
      {{/if}}
    </div>
    {{/if}}
    
    {{#if (eq itemType "equipment")}}
    <div class="equipment-effect-notes">
      <h4><i class="fas fa-hammer"></i> {{localize 'ZWOLF.EquipmentEffects'}}</h4>
      <p class="notes">{{localize 'ZWOLF.EquipmentEffectNotes'}}</p>
      
      {{#if system.equipped}}
      <div class="equipped-status active">
        <i class="fas fa-check-circle"></i> {{localize 'ZWOLF.EquippedActive'}}
      </div>
      {{else}}
      <div class="equipped-status inactive">
        <i class="fas fa-times-circle"></i> {{localize 'ZWOLF.EquippedInactive'}}
      </div>
      {{/if}}
    </div>
    {{/if}}
    
  </div>
</section>