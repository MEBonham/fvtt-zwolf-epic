{{!-- templates/item/parts/item-abilities.hbs --}}
<div class="tab" data-group="primary" data-tab="abilities" data-part-id="tab-abilities">
  <div class="granted-abilities">
    <div class="abilities-header">
      <h3>{{localize 'ZWOLF.GrantedAbilities'}}</h3>
      {{#if editable}}
        {{#if (eq itemType "track")}}
          {{!-- For tracks, show add button for each tier --}}
          <div class="track-add-abilities-info">
            <i class="fas fa-info-circle"></i>
            {{localize 'ZWOLF.AddAbilitiesByTierBelow'}}
          </div>
        {{else}}
          {{!-- For non-track items, single add button --}}
          <a class="ability-control" data-action="add-ability" title="{{localize 'ZWOLF.AddAbility'}}">
            <i class="fas fa-plus"></i>
          </a>
        {{/if}}
      {{/if}}
    </div>

    {{#if (eq itemType "track")}}
      {{!-- Track items: Show abilities grouped by tier --}}
      {{#each (range 1 6) as |tierNumber|}}
        <div class="tier-abilities-group" data-tier="{{tierNumber}}">
          <div class="tier-abilities-header">
            <h4>
              <i class="fas fa-layer-group"></i>
              {{localize 'ZWOLF.Tier'}} {{tierNumber}}
            </h4>
            {{#if ../editable}}
              <a class="ability-control"
                 data-action="add-ability"
                 data-tier="{{tierNumber}}"
                 title="{{localize 'ZWOLF.AddAbilityToTier'}}">
                <i class="fas fa-plus"></i>
              </a>
            {{/if}}
          </div>

          <div class="abilities-list">
            {{#each (lookup ../../abilitiesByTier tierNumber) as |ability|}}
              {{> ability-item
                  ability=ability
                  id=ability.id
                  index=ability.index
                  nameTarget=ability.nameTarget
                  tagsTarget=ability.tagsTarget
                  typeTarget=ability.typeTarget
                  descriptionTarget=ability.descriptionTarget
                  tierTarget=ability.tierTarget
                  showTier=true
                  deleteAction="delete-ability"
                  editable=../../../editable
                  owner=../../../owner}}
            {{else}}
              <div class="no-abilities-tier">
                {{localize "ZWOLF.NoAbilitiesThisTier"}}
              </div>
            {{/each}}
          </div>
        </div>
      {{/each}}

    {{else}}
      {{!-- Non-track items: Show all abilities as flat list --}}
      <div class="abilities-list">
        {{#each grantedAbilitiesArray as |ability|}}
          {{> ability-item
              ability=ability
              id=ability.id
              index=ability.index
              nameTarget=ability.nameTarget
              tagsTarget=ability.tagsTarget
              typeTarget=ability.typeTarget
              descriptionTarget=ability.descriptionTarget
              tierTarget=ability.tierTarget
              showTier=false
              deleteAction="delete-ability"
              editable=../editable
              owner=../owner}}
        {{else}}
          <div class="no-abilities">
            {{localize "ZWOLF.NoAbilitiesYet"}}
          </div>
        {{/each}}
      </div>
    {{/if}}
  </div>
</div>
