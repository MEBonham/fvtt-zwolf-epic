<form class="{{cssClass}} flexcol" autocomplete="off">
  <div class="item-sheet-content">
    <header class="sheet-header">
      <img class="profile-img" src="{{item.img}}" data-edit="img" title="{{item.name}}" height="64" width="64"/>
      <div class="header-fields">
        <h1 class="charname">
          <input name="name" type="text" value="{{item.name}}" placeholder="{{localize 'ZWOLF.ItemName'}}"/>
        </h1>
        <div class="item-subtitle">{{localize 'ZWOLF.ItemTypeKnack'}}</div>
      </div>
    </header>

    <nav class="sheet-tabs tabs" data-group="primary">
      <a class="item" data-tab="details">{{localize 'ZWOLF.Details'}}</a>
      <a class="item" data-tab="sideeffects">{{localize 'ZWOLF.SideEffects'}}</a>
      <a class="item" data-tab="abilities">{{localize 'ZWOLF.GrantedAbilities'}}</a>
    </nav>

    <section class="sheet-body">
      <div class="tab" data-group="primary" data-tab="details">
        <!-- For item-level tags (not granted ability tags) -->
        <div class="form-group">
          <label>{{localize 'ZWOLF.Tags'}}</label>
          <input type="text" name="system.tags" value="{{join system.tags}}" placeholder="{{localize 'ZWOLF.TagsPlaceholder'}}"/>
          <p class="notes">{{localize 'ZWOLF.TagsHint'}}</p>
        </div>

        <div class="form-group">
          <label>{{localize 'ZWOLF.CharacterTags'}}</label>
          <input type="text" name="system.characterTags" value="{{join system.characterTags}}" placeholder="{{localize 'ZWOLF.CharacterTagsPlaceholder'}}"/>
          <p class="notes">{{localize 'ZWOLF.CharacterTagsHint'}}</p>
        </div>

        <!-- Required Section -->
        <div class="form-group">
          <label>{{localize 'ZWOLF.Required'}}</label>
          <div class="form-fields">
            {{editor system.required target="system.required" button=true owner=owner editable=editable}}
          </div>
        </div>
      </div>

      <!-- Side Effects Tab -->
      <div class="tab" data-group="primary" data-tab="sideeffects">
        <div class="side-effects">
          <div class="side-effects-header">
            <h3>{{localize 'ZWOLF.SideEffects'}}</h3>
            <p class="notes">{{localize 'ZWOLF.SideEffectsHint'}}</p>
          </div>
          
          <!-- Progression Upgrades Section -->
          <div class="progression-upgrades">
            <h4><i class="fas fa-arrow-up"></i> {{localize 'ZWOLF.ProgressionUpgrades'}}</h4>
            
            <!-- Speed Upgrade -->
            <div class="form-group">
              <label>{{localize 'ZWOLF.SpeedProgression'}}</label>
              <select name="system.sideEffects.speedProgression" data-dtype="String">
                <option value="" {{selected '' system.sideEffects.speedProgression}}>{{localize 'ZWOLF.NoUpgrade'}} (+0)</option>
                <option value="mediocre" {{selected 'mediocre' system.sideEffects.speedProgression}}>{{localize 'ZWOLF.Mediocre'}}</option>
                <option value="moderate" {{selected 'moderate' system.sideEffects.speedProgression}}>{{localize 'ZWOLF.Moderate'}}</option>
                <option value="specialty" {{selected 'specialty' system.sideEffects.speedProgression}}>{{localize 'ZWOLF.Specialty'}}</option>
                <option value="awesome" {{selected 'awesome' system.sideEffects.speedProgression}}>{{localize 'ZWOLF.Awesome'}}</option>
              </select>
              <p class="notes">{{localize 'ZWOLF.SpeedProgressionHint'}}</p>
            </div>
            
            <!-- Toughness TN Upgrade -->
            <div class="form-group">
              <label>{{localize 'ZWOLF.ToughnessTNProgression'}}</label>
              <select name="system.sideEffects.toughnessTNProgression" data-dtype="String">
                <option value="" {{selected '' system.sideEffects.toughnessTNProgression}}>{{localize 'ZWOLF.NoUpgrade'}} ({{localize 'ZWOLF.Mediocre'}})</option>
                <option value="moderate" {{selected 'moderate' system.sideEffects.toughnessTNProgression}}>{{localize 'ZWOLF.Moderate'}}</option>
                <option value="specialty" {{selected 'specialty' system.sideEffects.toughnessTNProgression}}>{{localize 'ZWOLF.Specialty'}}</option>
                <option value="awesome" {{selected 'awesome' system.sideEffects.toughnessTNProgression}}>{{localize 'ZWOLF.Awesome'}}</option>
              </select>
              <p class="notes">{{localize 'ZWOLF.ToughnessTNProgressionHint'}}</p>
            </div>
            
            <!-- Destiny TN Upgrade -->
            <div class="form-group">
              <label>{{localize 'ZWOLF.DestinyTNProgression'}}</label>
              <select name="system.sideEffects.destinyTNProgression" data-dtype="String">
                <option value="" {{selected '' system.sideEffects.destinyTNProgression}}>{{localize 'ZWOLF.NoUpgrade'}} ({{localize 'ZWOLF.Moderate'}})</option>
                <option value="specialty" {{selected 'specialty' system.sideEffects.destinyTNProgression}}>{{localize 'ZWOLF.Specialty'}}</option>
                <option value="awesome" {{selected 'awesome' system.sideEffects.destinyTNProgression}}>{{localize 'ZWOLF.Awesome'}}</option>
              </select>
              <p class="notes">{{localize 'ZWOLF.DestinyTNProgressionHint'}}</p>
            </div>
          </div>
          
          <!-- Vision Radius Upgrades Section -->
          <div class="vision-radius-upgrades">
            <h4><i class="fas fa-eye"></i> Vision Radius Upgrades</h4>
            <p class="notes">Upgrade your character's special vision types. Only the highest value from all sources is applied.</p>
            
            <!-- Nightsight Radius -->
            <div class="form-group">
              <label>Nightsight Radius (meters)</label>
              <div class="vision-input-group">
                <input type="number" name="system.sideEffects.nightsightRadius" 
                       value="{{system.sideEffects.nightsightRadius}}" 
                       data-dtype="Number" min="0" step="0.5" 
                       placeholder="Default: 1.0" style="width: 120px;"/>
                <span class="input-suffix">meters</span>
              </div>
              <p class="notes">Upgrade nightsight radius from the default of 1 meter. Leave empty to use default.</p>
            </div>
            
            <!-- Darkvision Radius -->
            <div class="form-group">
              <label>Darkvision Radius (meters)</label>
              <div class="vision-input-group">
                <input type="number" name="system.sideEffects.darkvisionRadius" 
                       value="{{system.sideEffects.darkvisionRadius}}" 
                       data-dtype="Number" min="0" step="0.5" 
                       placeholder="Default: 0.5" style="width: 120px;"/>
                <span class="input-suffix">meters</span>
              </div>
              <p class="notes">Upgrade darkvision radius from the default of 0.5 meters. Leave empty to use default.</p>
            </div>
          </div>
          
          <!-- Placeholder for Future Side Effects -->
          <div class="future-side-effects" style="margin-top: 2rem; padding: 1rem; background: rgba(120, 46, 34, 0.05); border-radius: 5px; border: 1px dashed #782e22;">
            <h4><i class="fas fa-plus-circle"></i> {{localize 'ZWOLF.FutureSideEffects'}}</h4>
            <p class="notes" style="margin: 0; font-style: italic; color: #666;">{{localize 'ZWOLF.FutureSideEffectsHint'}}</p>
          </div>
        </div>
      </div>

      <!-- Granted Abilities Tab -->
      <div class="tab" data-group="primary" data-tab="abilities">
        <div class="granted-abilities">
          <div class="abilities-header">
            <h3>{{localize 'ZWOLF.GrantedAbilities'}}</h3>
            <a class="ability-control" data-action="add-ability" title="{{localize 'ZWOLF.AddAbility'}}">
              <i class="fas fa-plus"></i>
            </a>
          </div>
          
          <div class="abilities-list">
            {{#each system.grantedAbilities as |ability index|}}
            <div class="ability-item" data-ability-index="{{index}}">
              <div class="ability-controls">
                <a class="ability-control" data-action="delete-ability" data-ability-index="{{index}}" title="{{localize 'ZWOLF.DeleteAbility'}}">
                  <i class="fas fa-trash"></i>
                </a>
              </div>
              
              <div class="form-group">
                <label>{{localize 'ZWOLF.Name'}}</label>
                <input type="text" name="system.grantedAbilities.{{index}}.name" value="{{ability.name}}" placeholder="{{localize 'ZWOLF.AbilityNamePlaceholder'}}"/>
              </div>
              
              <div class="form-group">
                <label>{{localize 'ZWOLF.Tags'}}</label>
                <input type="text" name="system.grantedAbilities.{{index}}.tags" value="{{ability.tags}}" placeholder="{{localize 'ZWOLF.AbilityTagsPlaceholder'}}"/>
                <p class="notes">{{localize 'ZWOLF.AbilityTagsHint'}}</p>
              </div>
              
              <div class="form-group">
                <label>{{localize 'ZWOLF.Type'}}</label>
                <select name="system.grantedAbilities.{{index}}.type">
                  <option value="passive" {{selected 'passive' ability.type}}>{{localize 'ZWOLF.Passive'}}</option>
                  <option value="exoticSenses" {{selected 'exoticSenses' ability.type}}>{{localize 'ZWOLF.ExoticSenses'}}</option>
                  <option value="dominantAction" {{selected 'dominantAction' ability.type}}>{{localize 'ZWOLF.DominantAction'}}</option>
                  <option value="swiftAction" {{selected 'swiftAction' ability.type}}>{{localize 'ZWOLF.SwiftAction'}}</option>
                  <option value="reaction" {{selected 'reaction' ability.type}}>{{localize 'ZWOLF.Reaction'}}</option>
                  <option value="freeAction" {{selected 'freeAction' ability.type}}>{{localize 'ZWOLF.FreeAction'}}</option>
                  <option value="strike" {{selected 'strike' ability.type}}>{{localize 'ZWOLF.Strike'}}</option>
                  <option value="journey" {{selected 'journey' ability.type}}>{{localize 'ZWOLF.Journeying'}}</option>
                  <option value="miscellaneous" {{selected 'miscellaneous' ability.type}}>{{localize 'ZWOLF.Miscellaneous'}}</option>
                </select>
              </div>
              <div class="form-group">
                <label>{{localize 'ZWOLF.Description'}}</label>
                <div class="form-fields">
                  {{#if @root.editable}}
                    {{editor ability.description target=(concat "system.grantedAbilities." @index ".description") button=true editable=editable engine="prosemirror" collaborate=false}}
                  {{else}}
                    <div class="editor-content">{{{ability.enrichedDescription}}}</div>
                  {{/if}}
                </div>
              </div>
            </div>
            {{/each}}
          </div>
        </div>
      </div>
    </section>
  </div>
</form>