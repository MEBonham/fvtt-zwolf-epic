# Context Archive: Item Resistance & Vulnerability Side Effects

**Date**: 2026-01-24
**Topic**: Adding damage type resistance and vulnerability side effects to items

## Summary

Added support for items to grant resistance or vulnerability to damage types as side effects. This involved copying the config file from the archive, updating the data schema, creating UI controls, and wiring everything together.

## Changes Made

### 1. Config File
- **Copied**: `archive 2026-01-23/module/helpers/config.mjs` → `module/helpers/config.mjs`
- Contains ZWOLF configuration including:
  - 11 damage types (bludgeoning, piercing, slashing, heat, cold, lightning, corrosion, force, psychic, radiant, necrotic)
  - Attributes, skills, sizes, conditions, spell seeds, proficiencies

### 2. Data Schema (template.json)
- Added `"resistances": []` to `sideEffectsCapable` template
- Added `"vulnerabilities": []` to `sideEffectsCapable` template
- Added both fields to all 5 track tier `sideEffects` structures (tier1-tier5)
- Both stored as arrays to support multiple damage type selections

### 3. UI Template (templates/item/partials/side-effects-form.hbs)
- Added **Damage Resistances** section:
  - Icon: `fa-shield-alt`
  - Checkboxes for each damage type from `config.damageTypes`
  - Uses `includes` helper to check existing selections
  - Field name: `{{pathPrefix}}.resistances`

- Added **Damage Vulnerabilities** section:
  - Icon: `fa-heart-broken`
  - Same structure as resistances
  - Field name: `{{pathPrefix}}.vulnerabilities`

### 4. Localization (lang/en.json)
Added strings for:
- `DamageResistances`, `DamageResistancesHint`
- `Resistances`, `ResistancesHint`
- `DamageVulnerabilities`, `DamageVulnerabilitiesHint`
- `Vulnerabilities`, `VulnerabilitiesHint`
- All 11 damage type labels (e.g., `DamageBludgeoning`, `DamageHeat`, etc.)

### 5. Item Sheet (module/sheets/item-sheet.mjs)
- Updated `_prepareContext()` to include `context.config = CONFIG.ZWOLF`
- Allows templates to access damage types and other config data

### 6. System Initialization (module/zwolf-epic.mjs)
- Imported: `import { ZWOLF } from "./helpers/config.mjs"`
- Registered: `CONFIG.ZWOLF = ZWOLF` in init hook
- Makes config available globally throughout the system

### 7. Tier Template (templates/item/partials/tier-template.hbs)
- Updated side-effects-form partial call to pass `config=../config`
- Ensures track tier side effects have access to config data

## Technical Implementation

**Data Structure**:
```json
"sideEffects": {
  "resistances": ["heat", "cold"],
  "vulnerabilities": ["lightning"]
}
```

**Handlebars Pattern**:
```handlebars
{{#each config.damageTypes}}
  <input type="checkbox"
         name="{{../pathPrefix}}.resistances"
         value="{{@key}}"
         {{#if (includes ../sideEffects.resistances @key)}}checked{{/if}}
         data-dtype="Array"/>
{{/each}}
```

**Key Points**:
- Uses `data-dtype="Array"` for proper form handling of multi-select checkboxes
- Handlebars `includes` helper checks if damage type key exists in array
- Config passed through template context chain for partial access

## Files Modified

1. `module/helpers/config.mjs` (new file - copied from archive)
2. `template.json` (added resistances/vulnerabilities to 6 locations)
3. `templates/item/partials/side-effects-form.hbs` (added 2 new sections)
4. `lang/en.json` (added 15 localization strings)
5. `module/sheets/item-sheet.mjs` (added config to context)
6. `module/zwolf-epic.mjs` (imported and registered config)
7. `templates/item/partials/tier-template.hbs` (passed config to partial)

## Current State

- ✅ Config file in place with all damage types defined
- ✅ Data schema supports resistances and vulnerabilities as arrays
- ✅ UI displays checkbox controls for both features
- ✅ Localization complete for all strings
- ✅ Config properly wired through initialization and templates
- ✅ Both item-level and track-tier side effects supported

## Damage Types Reference

The system includes 11 damage types with colors and icons:
- Physical: bludgeoning, piercing, slashing
- Elemental: heat, cold, lightning
- Magical: corrosion, force, psychic, radiant, necrotic